# Server Configuration
NODE_ENV=development
# Trust X-Forwarded-* headers when running behind a reverse proxy.
# Recommended:
# - development: false (default)
# - production/test: true (default)
TRUST_PROXY=false
PORT=5000
API_VERSION=v1

# Database
# Default (local dev): SQLite in backend/dev.db
DATABASE_URL="file:./dev.db"

# Optional (production): PostgreSQL
# DATABASE_URL="postgresql://username:password@localhost:5432/electrical_supplier?schema=public"

# JWT Secret
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production
JWT_EXPIRES_IN=15m
JWT_REFRESH_SECRET=your-refresh-token-secret-change-this-in-production
JWT_REFRESH_EXPIRES_IN=7d

# Cookie Secret (for signed cookies)
COOKIE_SECRET=your-cookie-secret-change-this-in-production

# CORS
# Single origin (recommended for production):
# CORS_ORIGIN=https://your-domain.com
#
# Multiple origins (comma-separated) for local dev / tooling:
# CORS_ORIGIN=http://localhost:5173,http://localhost:4173
CORS_ORIGIN=http://localhost:5173

# Redis (Optional - for distributed rate limiting across multiple servers)
# Leave empty to use in-memory rate limiting
REDIS_URL=

# Captcha (Optional - Cloudflare Turnstile or hCaptcha)
# Leave empty to disable captcha validation
# Turnstile site keys start with "0x", hCaptcha keys don't
CAPTCHA_SITE_KEY=
CAPTCHA_SECRET_KEY=

# Email Configuration (Nodemailer)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_SECURE=false
SMTP_USER=your-email@gmail.com
SMTP_PASS=your-app-password
EMAIL_FROM=noreply@electricalsupplier.com
ADMIN_EMAIL=admin@electricalsupplier.com

# Optional: override recipient for the SMTP smoke-test script
# npm run email:test -- --to someone@example.com
SMTP_TEST_TO=

# WhatsApp (Optional - for notifications)
WHATSAPP_API_URL=
WHATSAPP_API_KEY=

# File Upload
UPLOAD_DIR=./uploads
MAX_FILE_SIZE=5242880
MAX_FILES_PER_UPLOAD=10
ALLOWED_IMAGE_TYPES=image/jpeg,image/png,image/webp
ALLOWED_DOC_TYPES=application/pdf

# Storage Provider (local, s3, or r2)
STORAGE_PROVIDER=local

# AWS S3 Configuration (for STORAGE_PROVIDER=s3)
# Get credentials from AWS IAM console
S3_REGION=us-east-1
S3_BUCKET=your-bucket-name
S3_ACCESS_KEY_ID=
S3_SECRET_ACCESS_KEY=
S3_PUBLIC_URL=
S3_PUBLIC_BUCKET=true

# Cloudflare R2 Configuration (for STORAGE_PROVIDER=r2)
# Get credentials from Cloudflare dashboard
# S3_REGION=auto
# S3_BUCKET=your-bucket-name
# S3_ACCESS_KEY_ID=your-r2-access-key
# S3_SECRET_ACCESS_KEY=your-r2-secret-key
# S3_ENDPOINT=https://your-account-id.r2.cloudflarestorage.com
# S3_PUBLIC_URL=https://your-custom-domain.com

# Malware Scanning (none, virustotal, or clamav)
MALWARE_SCAN_PROVIDER=none

# Malware scan failure behavior
# fail_open: if scanning fails/misconfigured, allow upload (default)
# fail_closed: if scanning fails/misconfigured, block upload
MALWARE_SCAN_FAIL_MODE=fail_open

# VirusTotal Configuration (for MALWARE_SCAN_PROVIDER=virustotal)
# Get API key from https://www.virustotal.com/gui/my-apikey
VIRUSTOTAL_API_KEY=

# ClamAV Configuration (for MALWARE_SCAN_PROVIDER=clamav)
# Requires clamd running (docker run -d -p 8080:8080 mkodockx/docker-clamav:alpine)
CLAMAV_HOST=
CLAMAV_PORT=8080

# Logging Configuration
# LOG_LEVEL: trace, debug, info, warn, error, fatal (default: debug in dev, info in prod)
LOG_LEVEL=debug
# LOG_FORMAT: json or pretty (default: json in prod, pretty in dev)
LOG_FORMAT=pretty

# Sentry Error Tracking (Optional - for production monitoring)
# Get DSN from https://sentry.io after creating a project
# Leave empty to disable Sentry
SENTRY_DSN=
SENTRY_ENVIRONMENT=development
SENTRY_RELEASE=
# Force Sentry in development (default: only enabled in production)
SENTRY_ENABLED=false

# Rate Limiting
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100
# Auth endpoints (login/refresh/etc)
# Note: the auth/2FA limiters are intentionally lenient in development.
AUTH_RATE_LIMIT_WINDOW_MS=900000
AUTH_RATE_LIMIT_MAX_REQUESTS=5
# Two-Factor endpoints
TWO_FACTOR_RATE_LIMIT_WINDOW_MS=300000
TWO_FACTOR_RATE_LIMIT_MAX_REQUESTS=5
QUOTE_RATE_LIMIT_WINDOW_MS=3600000
QUOTE_RATE_LIMIT_MAX_REQUESTS=5

# Anti-spam (additional to rate limiting)
# Blocks rapid duplicate submissions and caps submissions per email per day.
QUOTE_DEDUP_WINDOW_MS=600000
QUOTE_MAX_PER_EMAIL_PER_DAY=5

# Security
BCRYPT_ROUNDS=10

# Two-Factor Authentication (2FA)
# 2FA is optional and can be enabled per admin account
# TOTP codes work with Google Authenticator, Microsoft Authenticator, Authy, etc.
# Backup codes are provided for account recovery if authenticator is lost
