{
  "info": {
    "name": "Electrical Supplier Website API",
    "description": "Complete API collection for testing all endpoints including 2FA authentication",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "_postman_id": "electrical-supplier-api-2026",
    "version": "1.0.0"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:5000",
      "type": "string"
    },
    {
      "key": "apiPrefix",
      "value": "/api/v1",
      "type": "string"
    },
    {
      "key": "token",
      "value": "",
      "type": "string"
    },
    {
      "key": "adminId",
      "value": "",
      "type": "string"
    },
    {
      "key": "categoryId",
      "value": "",
      "type": "string"
    },
    {
      "key": "productId",
      "value": "",
      "type": "string"
    },
    {
      "key": "adminEmail",
      "value": "admin@electricalsupplier.com",
      "type": "string"
    },
    {
      "key": "adminPassword",
      "value": "",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "00. Health Check",
      "item": [
        {
          "name": "Health Check",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status is 200', () => {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Status is ok', () => {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.status).to.eql('ok');",
                  "});",
                  "",
                  "pm.test('Security features enabled', () => {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.security.helmet).to.be.true;",
                  "    pm.expect(json.security.rateLimiting).to.be.true;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/health",
              "host": ["{{baseUrl}}"],
              "path": ["health"]
            },
            "description": "Check server health and security status"
          }
        }
      ]
    },
    {
      "name": "01. Authentication (No 2FA)",
      "item": [
        {
          "name": "Login (No 2FA)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status is 200', () => {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Token received', () => {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.data.token).to.exist;",
                  "    pm.collectionVariables.set('token', json.data.token);",
                  "});",
                  "",
                  "pm.test('No 2FA required', () => {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.data.requiresTwoFactor).to.not.be.true;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{adminEmail}}\",\n  \"password\": \"{{adminPassword}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}{{apiPrefix}}/auth/login",
              "host": ["{{baseUrl}}{{apiPrefix}}"],
              "path": ["auth", "login"]
            }
          }
        },
        {
          "name": "Refresh Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status is 200', () => {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('New token received', () => {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.data.token).to.exist;",
                  "    pm.collectionVariables.set('token', json.data.token);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}{{apiPrefix}}/auth/refresh",
              "host": ["{{baseUrl}}{{apiPrefix}}"],
              "path": ["auth", "refresh"]
            },
            "description": "Note: Requires refreshToken cookie from login"
          }
        }
      ]
    },
    {
      "name": "02. Two-Factor Authentication",
      "item": [
        {
          "name": "Setup 2FA",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status is 200', () => {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('QR code and secret provided', () => {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.data.qrCode).to.exist;",
                  "    pm.expect(json.data.secret).to.exist;",
                  "});",
                  "",
                  "// Display QR secret for manual testing",
                  "console.log('TOTP Secret:', pm.response.json().data.secret);",
                  "console.log('Scan QR or enter secret to enable 2FA');"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token}}",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}{{apiPrefix}}/auth/2fa/setup",
              "host": ["{{baseUrl}}{{apiPrefix}}"],
              "path": ["auth", "2fa", "setup"]
            },
            "description": "Generate QR code for authenticator app"
          }
        },
        {
          "name": "Enable 2FA",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status is 200', () => {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('2FA enabled', () => {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.data.backupCodes).to.be.an('array');",
                  "    pm.expect(json.data.backupCodes.length).to.be.above(0);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token}}",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"token\": \"123456\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}{{apiPrefix}}/auth/2fa/enable",
              "host": ["{{baseUrl}}{{apiPrefix}}"],
              "path": ["auth", "2fa", "enable"]
            },
            "description": "Enable 2FA with TOTP code from authenticator app"
          }
        },
        {
          "name": "Get 2FA Status",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status is 200', () => {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Status returned', () => {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.data.enabled).to.exist;",
                  "    pm.expect(json.data.backupCodesRemaining).to.exist;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}{{apiPrefix}}/auth/2fa/status",
              "host": ["{{baseUrl}}{{apiPrefix}}"],
              "path": ["auth", "2fa", "status"]
            }
          }
        },
        {
          "name": "Login Step 1 (Credentials)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status is 200', () => {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('2FA required', () => {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.data.requiresTwoFactor).to.be.true;",
                  "    pm.expect(json.data.admin && json.data.admin.id).to.exist;",
                  "    pm.collectionVariables.set('adminId', json.data.admin.id);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{adminEmail}}\",\n  \"password\": \"{{adminPassword}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}{{apiPrefix}}/auth/login",
              "host": ["{{baseUrl}}{{apiPrefix}}"],
              "path": ["auth", "login"]
            },
            "description": "First step: authenticate with credentials"
          }
        },
        {
          "name": "Login Step 2 (Verify TOTP)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status is 200', () => {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Token received', () => {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.data.token).to.exist;",
                  "    pm.collectionVariables.set('token', json.data.token);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"adminId\": \"{{adminId}}\",\n  \"code\": \"123456\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}{{apiPrefix}}/auth/verify-2fa",
              "host": ["{{baseUrl}}{{apiPrefix}}"],
              "path": ["auth", "verify-2fa"]
            },
            "description": "Second step: verify TOTP code"
          }
        },
        {
          "name": "Verify with Backup Code",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status is 200', () => {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Verification successful', () => {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.data.verified).to.be.true;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"admin@electricalsupplier.com\",\n  \"token\": \"A1B2-C3D4-E5F6\",\n  \"useBackupCode\": true\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}{{apiPrefix}}/auth/2fa/verify",
              "host": ["{{baseUrl}}{{apiPrefix}}"],
              "path": ["auth", "2fa", "verify"]
            },
            "description": "Use backup code from setup step"
          }
        },
        {
          "name": "Disable 2FA",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status is 200', () => {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('2FA disabled', () => {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.data).to.be.null;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token}}",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"token\": \"123456\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}{{apiPrefix}}/auth/2fa/disable",
              "host": ["{{baseUrl}}{{apiPrefix}}"],
              "path": ["auth", "2fa", "disable"]
            },
            "description": "Disable 2FA (requires TOTP code)"
          }
        }
      ]
    },
    {
      "name": "03. Categories",
      "item": [
        {
          "name": "List Categories",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status is 200', () => {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Categories returned', () => {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.data.categories).to.be.an('array');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}{{apiPrefix}}/categories?page=1&limit=10",
              "host": ["{{baseUrl}}{{apiPrefix}}"],
              "path": ["categories"],
              "query": [
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "limit",
                  "value": "10"
                }
              ]
            }
          }
        },
        {
          "name": "Create Category",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status is 201', () => {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test('Category created', () => {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.data.category.id).to.exist;",
                  "    pm.collectionVariables.set('categoryId', json.data.category.id);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token}}",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"LED Lights\",\n  \"slug\": \"led-lights\",\n  \"description\": \"Energy-efficient LED lighting solutions\",\n  \"displayOrder\": 1\n}"
            },
            "url": {
              "raw": "{{baseUrl}}{{apiPrefix}}/categories",
              "host": ["{{baseUrl}}{{apiPrefix}}"],
              "path": ["categories"]
            }
          }
        },
        {
          "name": "Get Category by Slug",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}{{apiPrefix}}/categories/led-lights",
              "host": ["{{baseUrl}}{{apiPrefix}}"],
              "path": ["categories", "led-lights"]
            }
          }
        },
        {
          "name": "Update Category",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token}}",
                  "type": "string"
                }
              ]
            },
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"LED Lights Updated\",\n  \"description\": \"Updated description\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}{{apiPrefix}}/categories/{{categoryId}}",
              "host": ["{{baseUrl}}{{apiPrefix}}"],
              "path": ["categories", "{{categoryId}}"]
            }
          }
        },
        {
          "name": "Delete Category",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token}}",
                  "type": "string"
                }
              ]
            },
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}{{apiPrefix}}/categories/{{categoryId}}",
              "host": ["{{baseUrl}}{{apiPrefix}}"],
              "path": ["categories", "{{categoryId}}"]
            }
          }
        }
      ]
    },
    {
      "name": "04. Products",
      "item": [
        {
          "name": "List Products",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}{{apiPrefix}}/products?page=1&limit=20",
              "host": ["{{baseUrl}}{{apiPrefix}}"],
              "path": ["products"],
              "query": [
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "limit",
                  "value": "20"
                }
              ]
            }
          }
        },
        {
          "name": "Get Product by Slug",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}{{apiPrefix}}/products/:slug",
              "host": ["{{baseUrl}}{{apiPrefix}}"],
              "path": ["products", ":slug"],
              "variable": [
                {
                  "key": "slug",
                  "value": "product-slug"
                }
              ]
            }
          }
        }
      ]
    },
    {
      "name": "05. Quote Requests",
      "item": [
        {
          "name": "Submit Quote Request",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status is 201', () => {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test('Quote created', () => {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.data.quoteRequest.id).to.exist;",
                  "    pm.expect(json.data.quoteRequest.status).to.eql('new');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"John Doe\",\n  \"company\": \"ABC Electrical\",\n  \"phone\": \"+1234567890\",\n  \"whatsapp\": \"+1234567890\",\n  \"email\": \"john@abc.com\",\n  \"productName\": \"LED Panel Light 20W\",\n  \"quantity\": \"50 units\",\n  \"projectDetails\": \"Office renovation project\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}{{apiPrefix}}/quotes",
              "host": ["{{baseUrl}}{{apiPrefix}}"],
              "path": ["quotes"]
            }
          }
        },
        {
          "name": "List Quote Requests (Admin)",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}{{apiPrefix}}/quotes?page=1&limit=20",
              "host": ["{{baseUrl}}{{apiPrefix}}"],
              "path": ["quotes"],
              "query": [
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "limit",
                  "value": "20"
                }
              ]
            }
          }
        }
      ]
    },
    {
      "name": "06. File Upload",
      "item": [
        {
          "name": "Upload Image",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token}}",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "file",
                  "type": "file",
                  "src": []
                },
                {
                  "key": "type",
                  "value": "product",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}{{apiPrefix}}/upload",
              "host": ["{{baseUrl}}{{apiPrefix}}"],
              "path": ["upload"]
            }
          }
        },
        {
          "name": "Delete File",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token}}",
                  "type": "string"
                }
              ]
            },
            "method": "DELETE",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"filename\": \"product_1736937600000_abc123.jpg\",\n  \"type\": \"product\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}{{apiPrefix}}/upload",
              "host": ["{{baseUrl}}{{apiPrefix}}"],
              "path": ["upload"]
            }
          }
        },
        {
          "name": "Delete File - Path Traversal Attack",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status is 400', () => {",
                  "    pm.response.to.have.status(400);",
                  "});",
                  "",
                  "pm.test('Attack blocked', () => {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.success).to.be.false;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token}}",
                  "type": "string"
                }
              ]
            },
            "method": "DELETE",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"filename\": \"../../etc/passwd\",\n  \"type\": \"product\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}{{apiPrefix}}/upload",
              "host": ["{{baseUrl}}{{apiPrefix}}"],
              "path": ["upload"]
            },
            "description": "Security test: should be blocked"
          }
        }
      ]
    },
    {
      "name": "07. Rate Limiting Tests",
      "item": [
        {
          "name": "2FA Rate Limit Test",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "// This will run 6 times to trigger rate limit",
                  "const maxAttempts = 6;",
                  "const currentAttempt = pm.collectionVariables.get('rateLimitAttempt') || 1;",
                  "",
                  "if (currentAttempt <= maxAttempts) {",
                  "    pm.collectionVariables.set('rateLimitAttempt', currentAttempt + 1);",
                  "} else {",
                  "    pm.collectionVariables.set('rateLimitAttempt', 1);",
                  "}"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const attempt = pm.collectionVariables.get('rateLimitAttempt');",
                  "",
                  "if (attempt <= 5) {",
                  "    pm.test('Attempt ' + attempt + ': Invalid code error', () => {",
                  "        pm.response.to.have.status(401);",
                  "    });",
                  "} else {",
                  "    pm.test('Attempt 6: Rate limit triggered', () => {",
                  "        pm.response.to.have.status(429);",
                  "    });",
                  "    ",
                  "    pm.test('Retry-After header present', () => {",
                  "        pm.response.to.have.header('Retry-After');",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"adminId\": \"{{adminId}}\",\n  \"code\": \"000000\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}{{apiPrefix}}/auth/verify-2fa",
              "host": ["{{baseUrl}}{{apiPrefix}}"],
              "path": ["auth", "verify-2fa"]
            },
            "description": "Run this 6 times to trigger rate limit"
          }
        }
      ]
    }
  ],
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{token}}",
        "type": "string"
      }
    ]
  },
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          ""
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          ""
        ]
      }
    }
  ]
}
